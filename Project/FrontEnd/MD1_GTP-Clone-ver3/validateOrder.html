<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xác nhận đơn hàng</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300&family=Roboto:ital,wght@0,500;0,700;1,300&display=swap"
          rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon"
          href="https://theme.hstatic.net/200000388065/1000766714/14/logo.png?v=111"/>
    <link rel="stylesheet" href="fonts/fontawesome-free-6.2.0-web/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="script/Products.js"></script>
</head>

<body>
<div class="app">
    <!-- Header -->
    <div class="header">
        <div class="header-navbar__contact">
            <div class="header-navbar__contact-item">
                <i class="fa-sharp fa-solid fa-house-chimney"></i>
                <a href="">Hệ thống cửa hàng</a>
            </div>
            <div class="header-navbar__contact-item">
                <i class="fa-solid fa-phone"></i>
                <a href="">Mua hàng online: 0969436769</a>
            </div>
        </div>
        <div class="header-navbar-feat">
            <div class="grid">
                <div
                    class="header-navbar-container header-navbar-container--cart">
                    <div class="header-navbar-cart-item">
                        <div class="header-navbar-item">
                            <div class="header-navbar__logo">
                                <a href="index.html">
                                    <img
                                        src="https://theme.hstatic.net/200000388065/1000766714/14/logo.png?v=111"
                                        alt="" />
                                </a>
                            </div>
                        </div>
                        <div class="header-navbar-item">
                            <h1 class="header-navbar-cart-item">
                                Check Out
                            </h1>
                        </div>
                    </div>
                    <!-- <div
                        class="header-navbar-item header-navbar-item__float-right">
                        <input
                            oninput="actionSearch()"
                            id="searchProduct"
                            placeholder="Tìm kiếm"
                            class="header-navbar-cart__search"
                            type="text" />
                        <button class="header-navbar-cart-item">
                            <i class="bi bi-search"></i>
                        </button>
                    </div> -->
                    <div
                        class="header-navbar-item header-navbar-cart__user">
                        <ul class="header-navbar__features">
                            <li class="nav-account">
                                <span
                                    ><i class="bi bi-person-circle"></i
                                    ><span id="account"
                                        >Tài khoản</span
                                    ></span
                                >
                                <!-- Regis & Login -->
                                <div
                                    class="nav-account-container nav-account-container--cart-products">
                                    <a
                                        class="sign-up account-info"
                                        href="#"
                                        >Đăng kí</a
                                    >
                                    <a
                                        class="sign-in account-cart"
                                        href="#"
                                        >Đăng nhập</a
                                    >
                                    <a
                                        onclick="logOut()"
                                        class="logOut"
                                        href="login.html"></a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="path path-header">
        <div class="grid">
            <h1><a style="text-decoration: none; color: var(--primay-color)" href="index.html">Trang chủ</a> / <a style="text-decoration: none; color: var(--primay-color)" href="index.html">Giỏ hàng</a> / Xác nhận đơn hàng</h1>
        </div>
    </div>
    <div class="products">
        <div class="grid">
            <div class="product-lists cart-checked">
                <table class="products-table" style="width: 100%">
                    <tr
                        style="
                            height: 50px;
                            border-bottom: 1px solid #f5f6f9;
                        ">
                        <th width="50%" colspan="2">Products Ordered</th>
                        <th>Unit Price</th>
                        <th>Quantity</th>
                        <th>Total Price</th>
                    </tr>
                    <tbody id="draw-table">
                        <!--                <tr>-->
                        <!--                    <td>-->
                        <!--                        <img style="width: 80px"-->
                        <!--                             src="https://product.hstatic.net/200000388065/product/859cf541-b3c3-40bc-a43c-2ab90feb1e55_6f98e69436884d77a3cf97a4b0f9683f_large.jpg"-->
                        <!--                             alt="">-->
                        <!--                        <p style="padding: 10px">Amp Marshal MG10G 10W</p>-->
                        <!--                    </td>-->
                        <!--                    <td>2.000.000đ</td>-->
                        <!--                    <td>1</td>-->
                        <!--                    <td></td>-->
                        <!--                    <td>-->
                        <!--                        <button>delete</button>-->
                        <!--                    </td>-->
                        <!--                </tr>-->
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="3"></td>
                            <td style="color: var(--text-color)">Order Total (<span id="checkedItem"></span> item(s))</td>
                            <td style="color:red; font-size: 20px; font-weight: 500;" height="50" id="cartCheckTotal"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div class="best-sale-products">
                <div class="grid">
                    <div class="account-info-container validate-form">
                        <img src="img/logo/check%20icon%20img.png" alt="">
                        <h1>Xác nhận đơn hàng thành công</h1>
                        <a href="index.html"><i class="fa-solid fa-arrow-left-long"></i>Quay lại trang chủ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="grid">
            <div class="footer-container">
                <div class="footer-logo">
                    <img src="https://theme.hstatic.net/200000388065/1000766714/14/logo.png?v=111" alt="">
                </div>
                <ul class="footer-social">
                    <li><a href=""><i class="bi bi-youtube"></i></a></li>
                    <li><a href=""><i class="bi bi-instagram"></i></a></li>
                    <li><a href=""><i class="bi bi-facebook"></i></a></li>
                    <li><a href=""><i class="bi bi-twitter"></i></a></li>
                </ul>
                <div class="footer-copyright">
                    <h3>© 2021 GUITARPLUS • ALL RIGHTS RESERVED</h3>
                </div>
                <ul class="footer-link">
                    <li><a href="">Trang chủ</a></li>
                    <li><a href="">Sản phẩm</a></li>
                    <li><a href="">Thương hiệu</a></li>
                    <li><a href="">Blog</a></li>
                    <li><a href="">Giới thiệu</a></li>
                    <li><a href="">Liên hệ</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    let currentUser = JSON.parse(localStorage.getItem("current_user"));
    console.log(currentUser)

    // Kiểm tra đăng nhập
    if (currentUser !== null) {
        document.getElementById('account').innerHTML = currentUser.firstName + " " + currentUser.lastName;
        document.querySelector('.account-info').innerHTML = "Thông tin tài khoản";
        document.querySelector('.account-info').href = "account-information.html";
        document.querySelector('.account-cart').innerHTML = "Giỏ hàng";
        document.querySelector('.logOut').innerHTML = "Đăng xuất";
        document.querySelector('.logOut').style.color = "red";
        document.querySelector('.account-cart').href = "cart-products.html";

    } else {
        document.querySelector('.logOut').style.display = "none";
    }

    // Đăng xuất

    function logOut() {
        localStorage.removeItem("current_user");
        localStorage.removeItem("idKey");
        location.href =  "login.html";
    }

    // lấy toàn bộ thông tin sản phẩm lên local push vào mảng để vẽ

    let cartList = JSON.parse(localStorage.getItem('cartList'));
    if (cartList == null) {
        cartList = []
    }

    // function getCartUser (){
    //         let cartCurrentUser = [];
    //         if(currentUser !== null) {
        
    //             for (let i = 0; i < cartList.length; i++) {
    //                 if (cartList[i].userId == currentUser.id) {
    //                     cartCurrentUser.push(cartList[i]);
    //                 }
    //             }
    //         }
    //         return cartCurrentUser
    //     }
        

        // Tính tổng sản phẩm trong giỏ hàng "countProducts", sản phẩm còn lại trong giỏ "remainP"

        // function countProducts() {
        //     let remainProduct = 0;
        //     let countProducts = 0;
        //     let cartCurrentUser = getCartUser()
        //     if (currentUser !== null) {
        //         for (let i = 0; i < cartCurrentUser.length; i++) {
        //             if (cartCurrentUser[i].userId == currentUser.id) {
        //                 countProducts += cartCurrentUser[i].quantity;
        //             }
        //         }
        //     }
        //     if (cartCurrentUser.length < 4) {
        //         remainProduct = 0;
        //     } else {
        //         remainProduct = countProducts - 4;
        //     }

        //     document.getElementById('count').innerHTML = countProducts;
        //     document.getElementById('productsRemain').innerHTML = remainProduct;
        // }

        // countProducts()

        //  Show giỏ hàng đã checkout:
        let cartListChecked = JSON.parse(localStorage.getItem('cartListChecked'));
        console.log(cartListChecked);

        function showCart() {
                let countCheckedProducts = 0;
                let total;
                //cach 1 , dùng phuong thuc reduce
                total = cartListChecked.reduce(function (total, obj) {
                    if (obj.userId == currentUser.id) {
                        return total + obj.price * obj.quantity;
                    } else return total;
                    // obj => obj.price * obj.quantity
                }, 0);
                drawTable = "";
                    for (let i = 0; i < cartListChecked.length; i++) {
                        if (cartListChecked[i].userId == currentUser.id) {
                            drawTable += `<tr id="deleteTable">
                        <td>
                            <img style="width: 80px"
                                 src=${cartListChecked[i].image}
                                 alt="">
                        </td>
                        <td>
                            <p style="font-weight: bold; text-align: left;">${
                                cartListChecked[i].name
                            }</p>
                        </td>
                        <td style="color: red;">${formatNumber(
                            cartListChecked[i].price
                        )}</td>
                        <td><input disabled min="1" oninput="changeQuantity(${
                            cartListChecked[i].id
                        })" style="text-align: center" id="qt + ${
                                cartListChecked[i].id
                            }" value="${
                                cartListChecked[i].quantity
                            }" type="number"></td>
                        <td style="color: red;" class="total" id="id + ${
                            cartListChecked[i].id
                        }">${formatNumber(
                                cartListChecked[i].price * cartListChecked[i].quantity
                            )}</td>
                    </tr>`;
                    countCheckedProducts += cartListChecked[i].quantity;
                        }
                    }
                document.getElementById("draw-table").innerHTML = drawTable;
                document.getElementById("cartCheckTotal").innerHTML = formatNumber(total);
                document.getElementById("checkedItem").innerHTML = countCheckedProducts;
            }

            showCart();

        //  Vẽ minicart

        // function showMiniCart() {
        //     let size;
        //     let showMiniCart = "";
        //     let cartCurrentUser = getCartUser()
        
        //     if (currentUser !== null) {
        //         size = cartCurrentUser.length >= 4 ? 4 : cartCurrentUser.length
        //         for (let i = 0; i < size; i++) {
        //             showMiniCart += `<a href="cart-products.html" class="mini-cart-item">
        //                                         <div class="mini-cart-products">
        //                                             <div class="mini-cart-img-contain">
        //                                                 <img src=${cartCurrentUser[i].image} alt="">
        //                                             </div>
        //                                             <h3>${cartCurrentUser[i].name}</h3>
        //                                         </div>
        //                                         <div class="mini-cart-price">
        //                                             <p>${formatNumber(cartCurrentUser[i].price)}</p>
        //                                         </div>
        //                                     </a>`;
        //         }
        //     }
        //     document.getElementById('showMiniCart').innerHTML = showMiniCart;
        // }

        // showMiniCart()


        function formatNumber(number) {
            return new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'VND' }).format(number)
        }

    //     Lấy thông tin tài khoản

    // let listUsers = JSON.parse(localStorage.getItem('list_user'));
    // if (listUsers == null) {
    //     listUsers = [];
    // }
    // console.log(listUsers)

    // Điền form thông tin tài khoản

    // function getInfoUser() {
    //     let drawUserInfo = '';
    //     let accName = currentUser.firstName + " " + currentUser.lastName;
    //     drawUserInfo += `<tr>
    //                                             <td>Name:</td>
    //                                             <td>${currentUser.firstName + " " + currentUser.lastName} <a href="">Change</a></td>
    //                                         </tr>
    //                                         <tr>
    //                                             <td>Gender:</td>
    //                                             <td>${currentUser.gender} <a href="">Change</a></td>
    //                                         </tr>
    //                                         <tr>
    //                                             <td>Date of Birth:</td>
    //                                             <td>${currentUser.birth} <a href="">Change</a></td>
    //                                         </tr>
    //                                         <tr>
    //                                             <td>Address:</td>
    //                                             <td><a href="">Edit</a></td>
    //                                         </tr>
    //                                         <tr>
    //                                             <td>Email:</td>
    //                                             <td>${currentUser.email}</td>
    //                                         </tr>
    //                                         <tr>
    //                                             <td>Password:</td>
    //                                             <td>******* <a href="">Change</a></td>
    //                                         </tr>`
    //
    //     document.getElementById('drawInfoUser').innerHTML = drawUserInfo;
    //     document.getElementById('accName').innerHTML = accName;
    // }
    //
    // getInfoUser()
</script>
<script src="/script/checkUser.js"></script>
</body>

</html>