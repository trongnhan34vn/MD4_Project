<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thông tin tài khoản</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300&family=Roboto:ital,wght@0,500;0,700;1,300&display=swap"
          rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon"
          href="https://theme.hstatic.net/200000388065/1000766714/14/logo.png?v=111"/>
    <link rel="stylesheet" href="fonts/fontawesome-free-6.2.0-web/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="script/Products.js"></script>
</head>

<body>
<div class="app">
    <!-- Header -->
    <div class="header">
        <div id="header" class="header-navbar__contact">
            <div id="navContact" class="header-navbar__contact-item">
                <i class="fa-sharp fa-solid fa-house-chimney"></i>
                <a href="">Hệ thống cửa hàng</a>
            </div>
            <div class="header-navbar__contact-item">
                <i class="fa-solid fa-phone"></i>
                <a href="">Mua hàng online: 0969436769</a>
            </div>
        </div>
        <div id="navbar" class="header-navbar-feat header-navbar-feat--index">
            <div class="grid">
                <div class="header-navbar-container">
                    <div class="header-navbar-item">
                        <div class="header-navbar__logo">
                            <a href="index.html">
                                <img src="https://theme.hstatic.net/200000388065/1000766714/14/logo.png?v=111" alt="">
                            </a>
                        </div>
                    </div>
                    <div class="header-navbar-feature-container">
                        <div class="header-navbar-item">
                            <ul class="header-navbar__lists-item">
                                <li><a href="">Sản phẩm <i class="fa-solid fa-angle-down"></i></a></li>
                                <li><a href="">Sản phẩm mới</a></li>
                                <li><a href="">Thương hiệu <i class="fa-solid fa-angle-down"></i></a></li>
                                <li><a href="">Blog</a></li>
                                <li><a href="">Giới thiệu <i class="fa-solid fa-angle-down"></i></a></li>
                                <li><a href="">Liên hệ</a></li>
                            </ul>
                        </div>
                        <div class="header-navbar-item">
                            <ul class="header-navbar__features">
                                <li class="nav-search"><span><i class="bi bi-search"></i></span>
                                    <div class="nav-search-container">
                                        <input placeholder="Tìm kiếm..." type="text">
                                        <button><i class="fa-solid fa-magnifying-glass"></i></button>
                                    </div>
                                </li>
                                <li class="nav-account"><span><i class="bi bi-person-circle"></i><span id="account">Tài khoản</span></span>
                                    <!-- Regis & Login -->
                                    <div class="nav-account-container">
                                        <a class="sign-up account-info" href="register.html">Đăng kí</a>
                                        <a class="sign-in account-cart" href="login.html">Đăng nhập</a>
                                        <a onclick="logOut()" class="logOut" href="login.html"></a>
                                    </div>
                                </li>
                                <li class="mini-cart-contain"><a href="cart-products.html">
                                    <span><i class="bi bi-bag-fill"></i> Giỏ hàng</span><span id="count"></span></a>
                                    <div class="mini-cart">
                                        <h3>Thông tin giỏ hàng</h3>
                                        <div id="showMiniCart" class="mini-cart-body">

                                        </div>
                                        <div class="mini-cart-footer">
                                            <p class="mini-cart__products-remain">Còn <span id="productsRemain"></span>
                                                sản phẩm</p>
                                            <a href="cart-products.html">Xem giỏ hàng</a>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="path path-header">
        <div class="grid">
            <h1><a style="text-decoration: none; color: var(--primay-color)" href="index.html">Trang chủ</a> / Thông tin tài khoản</h1>
        </div>
    </div>
    <div class="products">
        <div class="grid">
            <div class="best-sale-title">
                <a href="#">
                    Thông tin tài khoản
                </a>
            </div>
            <div class="best-sale-products">
                <div class="grid">
                    <div class="account-info-container">
                        <div class="grid__row">
                            <div class="grid__column-12">
                                <div class="acc-info">
                                    <h3><i class="bi bi-person-circle"></i> <span id="accName">Nguyễn Nhân</span></h3>
                                    <div class="acc-info-feature">
                                        <h3>My account</h3>
                                        <div class="acc-info-detail">
                                            <p>Profile</p>
                                            <p>Change Password</p>
                                            <p>Address</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="grid__column-12-10">
                                <div class="acc-info-edit">
                                    <table>
                                        <tbody id="drawInfoUser">
                                        <tr>
                                            <td>Name:</td>
                                            <td>Nhân <a href="">Change</a></td>
                                        </tr>
                                        <tr>
                                            <td>Gender:</td>
                                            <td>Male <a href="">Change</a></td>
                                        </tr>
                                        <tr>
                                            <td>Date of Birth:</td>
                                            <td><input type="date"></td>
                                        </tr>
                                        <tr>
                                            <td>Address:</td>
                                            <td><a href="">Edit</a></td>
                                        </tr>
                                        <tr>
                                            <td>Email:</td>
                                            <td>trongnhan34vn@gmail.com <a href="">Change</a></td>
                                        </tr>
                                        <tr>
                                            <td>Password:</td>
                                            <td>******* <a href="">Change</a></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="grid">
            <div class="footer-container">
                <div class="footer-logo">
                    <img src="https://theme.hstatic.net/200000388065/1000766714/14/logo.png?v=111" alt="">
                </div>
                <ul class="footer-social">
                    <li><a href=""><i class="bi bi-youtube"></i></a></li>
                    <li><a href=""><i class="bi bi-instagram"></i></a></li>
                    <li><a href=""><i class="bi bi-facebook"></i></a></li>
                    <li><a href=""><i class="bi bi-twitter"></i></a></li>
                </ul>
                <div class="footer-copyright">
                    <h3>© 2021 GUITARPLUS • ALL RIGHTS RESERVED</h3>
                </div>
                <ul class="footer-link">
                    <li><a href="">Trang chủ</a></li>
                    <li><a href="">Sản phẩm</a></li>
                    <li><a href="">Thương hiệu</a></li>
                    <li><a href="">Blog</a></li>
                    <li><a href="">Giới thiệu</a></li>
                    <li><a href="">Liên hệ</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<script>
    let currentUser = JSON.parse(localStorage.getItem("current_user"));
    if(currentUser == null) {
        alert("Bạn chưa đăng nhập!");
        currentUser = {
            id:"",
            firstName:"",
            lastName:"",
            email:"",
            gender:"",
            birth:"",
        }
        location.href = "./login.html";
    } 
    console.log(currentUser)

    // Kiểm tra đăng nhập
    if (currentUser !== null) {
        document.getElementById('account').innerHTML = currentUser.firstName + " " + currentUser.lastName;
        document.querySelector('.account-info').innerHTML = "Thông tin tài khoản";
        document.querySelector('.account-info').href = "account-information.html";
        document.querySelector('.account-cart').innerHTML = "Giỏ hàng";
        document.querySelector('.logOut').innerHTML = "Đăng xuất";
        document.querySelector('.logOut').style.color = "red";
        document.querySelector('.account-cart').href = "cart-products.html";

    } else {
        document.querySelector('.logOut').style.display = "none";
    }

    // Đăng xuất

    function logOut() {
        localStorage.removeItem("current_user");
        localStorage.removeItem("idKey");
        location.href =  "login.html";
    }

    // lấy toàn bộ thông tin sản phẩm lên local push vào mảng để vẽ

    let cartList = JSON.parse(localStorage.getItem('cartList'));
    if (cartList == null) {
        cartList = []
    }

    function getCartUser (){
            let cartCurrentUser = [];
            if(currentUser !== null) {
        
                for (let i = 0; i < cartList.length; i++) {
                    if (cartList[i].userId == currentUser.id) {
                        cartCurrentUser.push(cartList[i]);
                    }
                }
            }
            return cartCurrentUser
        }
        

        // Tính tổng sản phẩm trong giỏ hàng "countProducts", sản phẩm còn lại trong giỏ "remainP"

        function countProducts() {
            let remainProduct = 0;
            let countProducts = 0;
            let cartCurrentUser = getCartUser()
            if (currentUser !== null) {
                for (let i = 0; i < cartCurrentUser.length; i++) {
                    if (cartCurrentUser[i].userId == currentUser.id) {
                        countProducts += cartCurrentUser[i].quantity;
                    }
                }
            }
            if (cartCurrentUser.length < 4) {
                remainProduct = 0;
            } else {
                remainProduct = countProducts - 4;
            }

            document.getElementById('count').innerHTML = countProducts;
            document.getElementById('productsRemain').innerHTML = remainProduct;
        }

        countProducts()

        //  Vẽ minicart

        function showMiniCart() {
            let size;
            let showMiniCart = "";
            let cartCurrentUser = getCartUser()
        
            if (currentUser !== null) {
                size = cartCurrentUser.length >= 4 ? 4 : cartCurrentUser.length
                for (let i = 0; i < size; i++) {
                    showMiniCart += `<a href="cart-products.html" class="mini-cart-item">
                                                <div class="mini-cart-products">
                                                    <div class="mini-cart-img-contain">
                                                        <img src=${cartCurrentUser[i].image} alt="">
                                                    </div>
                                                    <h3>${cartCurrentUser[i].name}</h3>
                                                </div>
                                                <div class="mini-cart-price">
                                                    <p>${formatNumber(cartCurrentUser[i].price)}</p>
                                                </div>
                                            </a>`;
                }
            }
            document.getElementById('showMiniCart').innerHTML = showMiniCart;
        }

        showMiniCart()


        function formatNumber(number) {
            return new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'VND' }).format(number)
        }

    function formatNumber(number) {
        return new Intl.NumberFormat('de-DE', {style: 'currency', currency: 'VND'}).format(number)
    }

    //     Lấy thông tin tài khoản

    let listUsers = JSON.parse(localStorage.getItem('list_user'));
    if (listUsers == null) {
        listUsers = [];
    }

    // Điền form thông tin tài khoản

    function getInfoUser() {
        console.log(currentUser.gender)
        let drawUserInfo = '';
        let accName = currentUser.firstName + " " + currentUser.lastName;
                drawUserInfo += `<tr>
                                    <td>Name:</td>
                                    <td>${currentUser.firstName + " " + currentUser.lastName} <a href="updateInfoUser.html">Change</a></td>
                                </tr>
                                <tr>
                                    <td>Gender:</td>
                                    <td>${currentUser.gender} <a href="updateInfoUser.html">Change</a></td>
                                </tr>
                                <tr>
                                    <td>Date of Birth:</td>
                                    <td>${currentUser.birth} <a href="updateInfoUser.html">Change</a></td>
                                </tr>
                                <tr>
                                    <td>Address:</td>
                                    <td><a href="">Edit</a></td>
                                </tr>
                                <tr>
                                    <td>Email:</td>
                                    <td>${currentUser.email}</td>
                                </tr>
                                <tr>
                                    <td>Password:</td>
                                    <td>******* <a href="updateInfoUser.html">Change</a></td>
                                </tr>`

        document.getElementById('drawInfoUser').innerHTML = drawUserInfo;
        document.getElementById('accName').innerHTML = accName;
    }

    getInfoUser()
</script>
<script src="script/fixedBar.js"></script>
</body>

</html>